function p(n,c,m){return{map:null,geocoder:null,circles:[],animationId:null,initialized:!1,async initMap(){if(this.initialized||(this.initialized=!0,await this.waitForGoogleMaps(),!window.google?.maps?.importLibrary))return;const{Map:e}=await google.maps.importLibrary("maps");await google.maps.importLibrary("geocoding"),this.map=new e(this.$refs.map,{center:m,zoom:10,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1,zoomControl:!1,gestureHandling:"none",draggable:!1,scrollwheel:!1,disableDoubleClickZoom:!0,minZoom:9,maxZoom:15,styles:[{elementType:"geometry",stylers:[{color:"#f4f6f9"}]},{elementType:"labels.text.fill",stylers:[{color:"#4b5563"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f4f6f9"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#d1d5db"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#eef2f7"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#6b7280"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#e5e7eb"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#6b7280"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#1e3a5f"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#f4f6f9"}]}]}),this.geocoder=new google.maps.Geocoder,await this.renderZipCircles(n,Math.max(c,1)),this.startPulseAnimation()},startPulseAnimation(){this.animationId&&cancelAnimationFrame(this.animationId);let e=0;const t=()=>{e+=.05,this.circles.forEach((a,s)=>{const o=e+s*.6,l=Math.sin(o),i=1+l*.08;a.setRadius(a.baseRadius*i);const r=.3+l*.05;a.setOptions({fillOpacity:r})}),this.animationId=requestAnimationFrame(t)};this.animationId=requestAnimationFrame(t)},async renderZipCircles(e,t){this.circles.forEach(o=>o.setMap(null)),this.circles=[];const s=(await Promise.all(e.map(async o=>{const l=await this.geocodeZip(o.zip);return l?{...o,location:l}:null}))).filter(Boolean);if(s.forEach(o=>{const i=2e3+Math.sqrt(o.count/t)*8e3,r=new google.maps.Circle({map:this.map,center:o.location,radius:i,fillColor:"#0ea5e9",fillOpacity:.3,strokeColor:"#0284c7",strokeOpacity:.8,strokeWeight:1});r.baseRadius=i,this.circles.push(r)}),s.length>0){const o=s.reduce((l,i)=>({lat:l.lat+i.location.lat,lng:l.lng+i.location.lng}),{lat:0,lng:0});this.map.setCenter({lat:o.lat/s.length,lng:o.lng/s.length}),this.map.setZoom(11)}},waitForGoogleMaps(){return new Promise(e=>{let t=0;const a=setInterval(()=>{t+=1,(window.google?.maps?.importLibrary||t>20)&&(clearInterval(a),e())},250)})},async geocodeZip(e){const t=this.getCachedZip(e);return t||new Promise(a=>{this.geocoder.geocode({address:`${e} USA`},(s,o)=>{if(o==="OK"&&s[0]){const l=s[0].geometry.location,i={lat:l.lat(),lng:l.lng()};this.setCachedZip(e,i),a(i);return}a(null)})})},getCachedZip(e){try{return JSON.parse(localStorage.getItem("zipGeoCache")||"{}")[e]||null}catch{return null}},setCachedZip(e,t){try{const a=JSON.parse(localStorage.getItem("zipGeoCache")||"{}");a[e]=t,localStorage.setItem("zipGeoCache",JSON.stringify(a))}catch{}}}}export{p as createProjectZipMap};
